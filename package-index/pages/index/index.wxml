<!-- 顶部横向分类视图 -->
<view class="top-category-scroll">
  <scroll-view class="category-scroll-view" scroll-x="true" show-scrollbar="false">
    <view class="category-scroll-content">
      <view 
        wx:for="{{categories}}" 
        wx:key="id" 
        class="category-item {{index === categoryIndex ? 'active' : ''}}"
        data-idx="{{index}}"
        bindtap="categoryClick">
        <view class="category-icon-wrapper">
          <view class="category-icon">
            <image wx:if="{{item.icon}}" class="category-icon-img" src="{{item.icon}}" mode="aspectFill"></image>
            <text wx:else class="category-icon-text">{{item.name}}</text>
          </view>
        </view>
        <view class="category-name">{{item.name}}</view>
      </view>
    </view>
  </scroll-view>
</view>

<view class="box1">
  <scroll-view class="box-2" scroll-y="true" scroll-top="{{scrollTop}}" bindscroll="onScroll" bindscrolltolower="_onReachBottom">
    <van-empty wx:if="{{!goods || goods.length == 0}}" description="{{ $t.common.empty }}" />
    <van-card
      wx:for="{{goods}}" wx:key="id"
      centered="true"
      lazy-load="true"
      origin-price="{{ (item.originalPrice > 0 && item.originalPrice != item.minPrice) ? item.originalPrice : '' }}"
      price="{{item.minPrice}}"
      thumb-mode="aspectFill"
      tag="{{ item.badge ? item.badge : '' }}"
      title="{{item.name}}"
      thumb-link="/package-goods/pages/goods-details/index?id={{ item.id }}"
      thumb="{{item.pic}}">
      <view slot="desc">
        <view wx:if="{{ item.miaosha && item.dateStartInt > 0 }}">
          <van-count-down class="count-downno-start" time="{{ item.dateStartInt }}" format="HH时mm分ss秒"></van-count-down>
        </view>
        <view wx:elif="{{ item.miaosha && item.dateStartInt <= 0 && item.dateEndInt > 0 }}">
          <van-count-down class="count-downno-start" time="{{ item.dateEndInt }}" format="HH时mm分ss秒"></van-count-down>
        </view>
        <view wx:elif="{{ item.kanjia }}">
          {{ $t.index.minPrice }} {{ item.kanjiaPrice }}
        </view>
        <view wx:else>{{ item.characteristic }}</view>
      </view>
      <view class="goods-btn" slot="footer">
        <van-button wx:if="{{ item.stores < item.minBuyNumber }}" size="small" color="#e64340" round disabled>{{ $t.goodsDetail.storeing }}</van-button>
        <van-button wx:elif="{{ item.miaosha && item.dateStartInt > 0 }}" size="small" color="#e64340" round disabled>{{ $t.index.noStart }}</van-button>
        <van-button wx:elif="{{ item.miaosha && item.dateEndInt <= 0 }}" size="small" color="#e64340" round disabled>{{ $t.index.miaoshaEnd }}</van-button>
        <van-button wx:elif="{{item.kanjia}}" size="small" color="#e64340" round data-idx="{{index}}" bind:click="goGoodsDetail">{{ $t.goodsDetail.kanjia }}</van-button>
        <van-button wx:elif="{{item.pingtuan}}" size="small" color="#e64340" round data-idx="{{index}}" bind:click="showGoodsDetailPOP">{{ $t.index.pingtuan }}</van-button>
        <van-button wx:elif="{{item.propertyIds || item.hasAddition || item.hasGoodsTimes}}" size="small" color="#e64340" round data-idx="{{index}}" bind:click="showGoodsDetailPOP">{{ $t.index.selectSku }}</van-button>
        <van-icon wx:else name="add" color="#e64340" size="50rpx" data-idx="{{index}}" bind:click="addCart1" />
      </view>
    </van-card>
  </scroll-view>
</view>

<view class="cart-bar" wx:if="{{shippingCarInfo && shippingCarInfo.number}}">
  <view class="l" bindtap="showCartPop">
    <van-button type="default" round icon="shopping-cart-o">{{ $t.cart.title }}</van-button>
    <view class="badge">{{shippingCarInfo.number}}</view>
  </view>  
  <view class="r">
    <view class="amount"><text>¥</text>{{shippingCarInfo.price}}</view>
    <view class="topay" bindtap="goPay">{{ $t.index.submit }}</view>
  </view>
</view>



<van-popup
  show="{{ showGoodsDetailPOP }}"
  custom-style="max-height: 80%;z-index:99999;"
  closeable
  close-icon="close"
  position="bottom"
  bind:close="hideGoodsDetailPOP">
  <scroll-view scroll-y="true" class="goods-detail-scroll">
    <image wx:if="{{ showGoodsDetailPOP }}" mode='aspectFill' class='photos-00' src='{{curGoodsMap.basicInfo.pic}}'></image>
    <view class="title-name">{{curGoodsMap.basicInfo.name}}</view>  
    <view wx:for="{{curGoodsMap.properties}}" wx:key="id" class="content-1">
      <view class="title">{{item.name}}</view>
      <view class="box-1">
        <view wx:for="{{item.childsCurGoods}}" wx:key="id" wx:for-item="small" wx:for-index="index2" class="title-1 {{small.selected?'active':''}}" data-idx1="{{index}}" data-idx2="{{index2}}" bindtap="skuClick">{{small.name}}</view>
      </view>
    </view>
    <view wx:for="{{goodsAddition}}" wx:key="id" class="content-1">
      <view class="title">{{item.name}}</view>
      <view class="box-1">
        <view wx:for="{{item.items}}" wx:key="id" wx:for-item="small" wx:for-index="index2" class="title-1 {{small.active?'active':''}}" data-idx1="{{index}}" data-idx2="{{index2}}" bindtap="skuClick2">{{small.name}}</view>
      </view>
    </view>
    <view wx:for="{{goodsTimesSchedule}}" wx:key="id" class="content-1">
      <view class="title">{{item.day}}</view>
      <view class="box-1">
        <view wx:for="{{item.items}}" wx:key="id" wx:for-item="small" wx:for-index="index2" class="title-1 {{small.active?'active':''}}" data-idx1="{{index}}" data-idx2="{{index2}}" bindtap="skuClick3">{{small.name}}</view>
      </view>
    </view>

    <view wx:if="{{curGoodsMap.content}}" class="introduce">
      <view class="title">{{ $t.goodsDetail.title }}</view>
      <view class="content">
        <parser html="{{curGoodsMap.content}}" />
      </view>
    </view>

    <view class="blank"></view>
    <view class="add-bar">
      <view class="add-box">
        <view class="price"><text>¥</text>{{curGoodsMap.price}}</view>
        <van-stepper value="{{ curGoodsMap.number }}" min="{{curGoodsMap.basicInfo.minBuyNumber}}" max="{{ buyNumMax }}" bind:change="goodsStepChange"/>
      </view>
      <view class="add-cart">
        <van-button wx:if="{{lijipingtuanbuy}}" block color="#e64340" bind:click="pingtuanbuy">{{ $t.index.pingtuan }}</van-button>
        <van-button wx:else block color="#e64340" bind:click="addCart2">{{ $t.goodsDetail.addCartBtn }}</van-button>
      </view>
    </view>
  </scroll-view>
</van-popup> 

<van-popup
  show="{{ showCartPop }}"
  position="bottom"
  custom-style="bottom: 100rpx;max-height: 80%;"
  bind:close="hideCartPop">
    <view class="empty-box" bindtap="clearCart">
      <van-icon name="delete" />
      <view class="empty-1">{{ $t.cart.clear }}</view>
    </view>
  <view wx:for="{{shippingCarInfo.items}}" wx:key="key" class="cart-goods-list">
    <view class="l">
      <view class="title">{{item.name}}</view>
      <view wx:if="{{item.sku}}" class="content">
        <block wx:for="{{item.sku}}" wx:key="optionValueId" wx:for-item="_sku">{{_sku.optionValueName}} </block>
      </view>
      <view wx:if="{{item.additions}}" class="content">
        <block wx:for="{{item.additions}}" wx:for-item="option" wx:key="index">{{option.name}} </block>
      </view>
      <view wx:if="{{item.goodsTimesDay && item.goodsTimesItem}}" class="content">
        <block>{{ item.goodsTimesDay }} {{ item.goodsTimesItem }}</block>
      </view>
    </view>
    <view class="r">
      <view class="price">¥{{ item.price }}</view>
      <van-stepper value="{{ item.number }}" min="0" async-change disable-input data-idx="{{index}}" bind:change="cartStepChange"/>
    </view>
  </view>
</van-popup>